<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Off-Grid Mining Microgrid · EMS Simulator</title>
  <link rel="icon" href="data:,">
  <!-- 样式：你的设计令牌 + 页面样式 -->
  <link rel="stylesheet" href="./assets/tokens.css">
  <link rel="stylesheet" href="./assets/styles.css">
  <style>
    /* 按钮的基础样式（保持轻量） */
    .controls button{padding:8px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;cursor:pointer}
    .controls button:disabled{opacity:.5;cursor:not-allowed}
  </style>
</head>
<body>
  <div class="container">
    <header style="display:flex;justify-content:space-between;align-items:center;margin:8px 0 6px">
      <h1 style="font-size:18px;margin:0">Off-Grid Mining Microgrid · V2 · Fuel-Saving Baseline</h1>
      <div id="engine-version" class="muted">Engine: <em>loading…</em></div>
    </header>

    <div class="grid">
      <!-- 左侧配置 -->
      <div class="card area-config">
        <h3>Scenario Config</h3>
        <div id="config-form"></div>
        <div class="controls" style="margin-top:10px;display:flex;gap:8px">
          <button id="btn-start">▶ Start</button>
          <button id="btn-pause" disabled>⏸ Pause</button>
          <button id="btn-reset">⟲ Reset</button>
        </div>
      </div>

      <!-- 右侧两张大图：纵向堆叠 -->
      <div class="area-charts">
        <div class="charts-stack">
          <div class="card">
            <h3>Power (MW) · Window</h3>
            <canvas id="plot-power" class="plot"></canvas>
          </div>
          <div class="card">
            <h3>Frequency (Hz) / SOC (%) · Window</h3>
            <canvas id="plot-energy" class="plot"></canvas>
          </div>
        </div>
      </div>

      <!-- 底部指标/日志区 -->
      <div class="area-metrics">
        <div class="card">
          <h3>Metrics & Log</h3>
          <div class="metrics-grid" id="live-panels">
            <div class="kv" id="live-metrics"></div>
            <div class="kv" id="live-state"></div>
          </div>
        </div>
        <div class="card">
          <h3>Notes</h3>
          <p class="muted">本页为展示层；算法由私库构建为 ESM 后通过 CI 同步到 <code>/vendor/core.esm.js</code>。</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 装配器：唯一入口 -->
  <script type="module" src="./modules/loader.js"></script>

  <!-- 运行失败/依赖缺失的用户可见提示 -->
  <div id="overlay" style="position:fixed;inset:0;background:rgba(255,255,255,.95);display:none;align-items:center;justify-content:center;z-index:9999">
    <div class="ovl-card" style="max-width:560px;border:1px solid #e5e7eb;border-radius:14px;background:#fff;padding:18px">
      <h3 style="margin:0 0 8px">Simulator loading status</h3>
      <div id="overlay-msg" class="muted">Initializing…</div>
      <pre id="overlay-log" class="kv" style="max-height:260px"></pre>
    </div>
  </div>
</body>
</html>
