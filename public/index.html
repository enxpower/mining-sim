<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mining Microgrid Simulator</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root{ --page-bg:#f8f9fb; --card-bg:#fff; --border:#e6e8ef; --text:#1f2430; --muted:#6b7280; --brand:#0b78ff; }
    html,body{margin:0;padding:0;background:var(--page-bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    .wrap{max-width:1200px;margin:0 auto;padding:16px;}
    h2{margin:8px 0 10px;font-size:16px;}
    .row{display:grid;grid-template-columns:1fr;gap:12px;}
    .card{background:var(--card-bg);border:1px solid var(--border);border-radius:10px;padding:12px;}
    .ctrl{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    label{color:var(--muted);font-size:12px;margin-right:6px;}
    input[type="number"],input[type="range"]{padding:6px 8px;border:1px solid var(--border);border-radius:8px;background:#fff;min-width:72px;}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn.is-busy{opacity:.7;pointer-events:none;position:relative}
    .btn.is-busy::after{content:"";position:absolute;right:10px;top:50%;width:12px;height:12px;margin-top:-6px;border:2px solid rgba(0,0,0,.2);border-top-color:var(--brand);border-radius:50%;animation:spin .7s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    canvas{width:100%;height:360px;display:block}
    .status{font-family:ui-monospace,Consolas,monaco,monospace;color:#394150;font-size:12px;padding:6px 10px;border-radius:8px;background:#f1f3f9;border:1px dashed #d7dbe7}
    .kpis{display:grid;grid-template-columns:repeat(8,1fr);gap:10px}
    @media (max-width:1200px){.kpis{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:640px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:10px}
    .kpi b{display:block;font-size:12px;color:var(--muted);margin-bottom:2px}
    .kpi span{font-weight:600}
    footer.site-footer{background:var(--page-bg);color:#333;border-top:1px solid var(--border);padding:18px 16px;font-size:13px}
    footer.site-footer a{color:var(--brand);text-decoration:none}
    footer.site-footer a:hover{text-decoration:underline}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:rgba(0,0,0,.78);color:#fff;padding:8px 14px;border-radius:8px;font-size:12px;z-index:9999;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
    .legend{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="card">
      <div class="ctrl" role="group" aria-label="simulation controls">
        <button id="btnStart" class="btn">▶ Start</button>
        <button id="btnPause" class="btn">⏸ Pause</button>
        <button id="btnReset" class="btn">⟲ Reset</button>
        <span class="legend" style="margin-left:10px;">
          Legend：PV=<span style="color:#E69F00">orange</span>，
          Wind=<span style="color:#D55E00">vermillion</span>，
          Load=<span style="color:#000000">black</span>，
          Diesel=<span style="color:#0072B2">blue</span>，
          BESS(+dis/−ch)=<span style="color:#009E73">green</span>
        </span>
      </div>

      <div class="ctrl" style="margin-top:10px">
        <label><input id="followLive" type="checkbox" checked> Follow live</label>
        <label>Window length (h)</label>
        <input id="winLen" type="number" min="0.5" step="0.5" value="4">
        <label>Window start (h)</label>
        <input id="winStart" type="range" min="0" max="24" step="0.1" value="0" style="width:280px">
        <span class="legend" id="winText">[0.0, 4.0] h</span>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <h2>功率（MW）· 视窗</h2>
        <canvas id="powerChart" aria-label="Power window chart" role="img"></canvas>
      </div>
      <div class="card">
        <h2>频率（Hz）/ SOC（%）· 视窗</h2>
        <canvas id="freqChart" aria-label="Frequency & SOC window chart" role="img"></canvas>
      </div>
    </div>

    <div class="card" style="margin-top:10px">
      <div id="status" class="status">—</div>
    </div>

    <div class="kpis" style="margin-top:10px">
      <div class="kpi"><b>燃油消耗</b><span id="k_fuelUsed">0 L</span></div>
      <div class="kpi"><b>燃油对照</b><span id="k_fuelBase">0 L</span></div>
      <div class="kpi"><b>燃油节省</b><span id="k_fuelSaved">0 L</span></div>
      <div class="kpi"><b>可再生占比</b><span id="k_renShare">0%</span></div>
      <div class="kpi"><b>PV 发电量</b><span id="k_pvE">0 MWh</span></div>
      <div class="kpi"><b>Wind 发电量</b><span id="k_windE">0 MWh</span></div>
      <div class="kpi"><b>弃电（PV+风）</b><span id="k_curtail">0 MWh</span></div>
      <div class="kpi"><b>N–1 校核</b><span id="k_n1">OK</span></div>
    </div>

  </div>

  <footer class="site-footer">
    © 2025 Energize Solutions Inc. – All rights reserved.
    Powered by GitHub Pages | Contact: <a href="mailto:info@energizeos.com">info@energizeos.com</a>
    <span style="margin-left:10px;">
      <a href="https://www.linkedin.com/in/gongtiejing" target="_blank" rel="noopener">LinkedIn</a> ·
      <a href="https://github.com/enxpower/mining-sim" target="_blank" rel="noopener">GitHub</a>
    </span>
  </footer>
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script type="module" src="../src/ui.js"></script>
</body>
</html>